---
title: "Multivariate Data Analysis"
author: "Juan Pablo Zaldivar && Enric Millán && Joel Solé"
date: "2023-05-11"
output: html_document
---

```{r setup, include=F, warnings=F, echo=F}

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo=FALSE)

YlGnBu = c("#ffffd9", "#edf8b1", "#c7e9b4", "#7fcdbb", "#41b6c4", "#1d91c0", "#225ea8", "#253494", "#081d58")

source("plots.R")

library(dplyr)
library(plotly)
library(ggplot2)
```

# Exploratory data analysis

```{r}
df <- read.csv2("glass.csv", header=TRUE, sep=",")
head(df)
```

```{r}
# Transform features into numeric
features <- names(df)[names(df) != "Type"]
df[features] <- lapply(df[features], as.numeric)

# Transform label as categorical
df$Type <- as.factor(df$Type)
```

```{r}
unique(df$Type)
```

```{r}
bar_plot <- plot_ly(data = df, x = ~Type,
                    color = ~Type, colors = "YlGnBu") %>%
  add_histogram() %>%
  layout(title = "Count of Types in df Dataset",
         xaxis = list(title = "Type"), yaxis = list(title = "Count"))

bar_plot
```

```{r}
# Compute correlation matrix
corr_matrix <- cor(df[, 1:9])

# Create a heatmap using Plotly
heatmap <- plot_ly(
  x = colnames(corr_matrix),
  y = colnames(corr_matrix),
  z = corr_matrix,
  type = "heatmap",
  colorscale = "YlGnBu"
)

# Add cell values to the heatmap
heatmap <- heatmap %>%
  add_annotations(
    x = rep(colnames(corr_matrix), each = length(colnames(corr_matrix))),
    y = rep(colnames(corr_matrix), length(colnames(corr_matrix))),
    text = round(corr_matrix, 2),
    showarrow = FALSE)

heatmap
```

```{r}
histogram_plots(df, ncol(df))
```

Ba and Fe are not very common elements.

```{r}
box_plots(df, ncol(df))
```


# Preprocesing

## Data transformation

```{r}
# Transform features into numeric
features <- names(df)[names(df) != "Type"]
df[features] <- lapply(df[features], as.numeric)

# Transform label as categorical
df$Type <- as.factor(df$Type)
```

As seen in the exploratory analysis, the Ba and Fe elements are not very common among all instances. For that reason, we have chosen to binarize those variables, setting them to 1 if the df instance contains Ba and Fe respectively (i.e. the value of the variables is greater than 0) and 0 otherwise.

```{r}
df_num <- df
# Categorize variable 'Ba'
df$Ba <- ifelse(df$Ba != 0.0, 1, 0)

# Categorize variable 'Fe'
df$Fe <- ifelse(df$Fe != 0.0, 1, 0)

df_cat <- df
```


## Missing values

```{r}
sum(is.na(df))
```

## Duplicated values

The row number 40 is a duplicate of the previous row.

```{r}
anyDuplicated(df)
df <- df[!duplicated(df),]
```
















.

